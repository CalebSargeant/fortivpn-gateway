name: Build Container Image

# This workflow:
# 1. Builds PR images on pull request events (tagged as pr-<number>)
# 2. When semantic-release creates a release, promotes PR images to the release version (no rebuild!)

on:
  pull_request:
    branches: [main]
    types: [opened, synchronize, reopened]
  release:
    types: [published]

permissions:
  contents: read
  packages: write
  id-token: write

jobs:
  docker:
    uses: calebsargeant/reusable-workflows/.github/workflows/docker-bake-ghcr.yaml@v1.0.23
    with:
      image_name: fortivpn-gateway
      platforms: linux/amd64
      # platforms: linux/amd64,linux/arm64
      push: true
    secrets: inherit
